language: go

go:
    - 1.9

install: skip
script: skip

jobs:
    include:
    - stage: test
      script:
      - mkdir -p $GOPATH/src/iosomething
      - rsync -az ${TRAVIS_BUILD_DIR}/ $GOPATH/src/iosomething/
      - export TRAVIS_BUILD_DIR=$GOPATH/src/iosomething
      - export GOOS=linux
      - export GOARCH=amd64
      - cd ${TRAVIS_BUILD_DIR}
      - make test
    - stage: deploy
      if: tag IS present
      script:
      - mkdir -p $GOPATH/src/iosomething
      - rsync -az ${TRAVIS_BUILD_DIR}/ $GOPATH/src/iosomething/
      - export TRAVIS_BUILD_DIR=$GOPATH/src/iosomething
      - export GOOS=linux
      - export GOARCH=amd64
      - cd ${TRAVIS_BUILD_DIR}
      - make deploy
